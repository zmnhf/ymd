# Youtube-dlでMusicをDLするやつ

素のyoutube-dlでは音声ファイルへのタグ付けが中途半端にしかできない、またトラック番号が動画投稿順にならないという短所があったので自分用に書きました

ただDL後に元のプレイリストの中身変わるとトラック番号崩れたり崩れなかったりしますめんどいのでいまのとこ対応するつもりないです

joblibでアーティストごとに並列処理するので普通に1曲ずつDLするよりかなり速いと思います

list.csvを更新するために毎回全動画の情報ひっぱってくるのでそこそこ重いかも

あまり使いすぎるとyoutubeから429返ってくるので気を付けましょう

一般的な契約ならルータ再起動すればいいだけの話だけど行儀はよくない

みんなには教えないでくださいね


## 環境

settings.iniとurllist.txtはutf-8で保存してください

python3系で動きます（2系は非対応）

必要なライブラリはソース見てください

win10とubuntu18.04のpython3.8.0で動作確認してます

macでもたぶん動く気がしますしらんけど


## 使い方

実行フォルダと同じところにsettings.iniとurllist.txtを置いて実行してください

urllist.txtはアーティスト名とプレイリストのurlを半角スペースで区切って記述してください、複数OK


## なんもわからん人向けwindows版

まず服を脱ぎます

●pythonが入ってるか確認します

winキーおしてcmdって打つとコマンドプロンプトが開くので、その黒い画面でpyってうってください

・python3.~みたいなのが出る：python3系が入っているので次に進みます

・python2.~みたいなのが出る：python2系は入ってるけど3系はわかりません、入ってるかも、pythonインストールに進んだほうがいいかも、わからん訊いてｋるえ

・pyは〜〜認識されていませんみたいなのが出る：python入っていない可能性が高いです、pythonインストールに進みます


●pythonをインストールします

ここから https://www.python.org/downloads/ インストーラをDL

バージョンは一番新しいやつでいいんじゃないでしょうか

インストール終わったら念の為再起動してコマンドプロンプトを起動し、

py -m pip install pandas joblib youtube-dl mutagen emoji

を実行します、なんかsuccess的な文言見えたら正常に終了してます


●あとffmpegが必要なので、とりあえずPCに入ってるか確認します

さっきの黒い窓上でffmpegって打って謎の文字列が大量に表示されてるならおｋです

"ffmpeg"は〜〜〜〜認識されてません

的な表示出たら

https://ffmpeg.zeranoe.com/builds/

からdownload buildってやつクリックして、DLしたzip解答して中にあるffmpeg.exeをC:\windowsの下にでも置いておいてください


●たぶんブラウザでgithub開いて今このページ見てると思うけど、

右側の緑色ボタン（clone or downloadってかいてあるやつ）をクリックしてdownload zipします

どっか適当なところで解凍したら、中身のurllist.txtとsettings.iniを編集してください


●urllist.txtの書き方

アーティスト名 プレイリストのurl1 プレイリストのurl2

アーティスト名2 プレイリストのurl3 プレイリストのurl4

みたいな感じで、行ごと書いてってください

プレイリストのurlはいくつでもおｋ、半角スペースで開けてね

アーティスト名がフォルダ名そしてm4aファイルのアーティストタグとアルバムタグになります

並列処理の都合上アーティスト名が重複してるとデッドロックかかるかも、試してないからわからんけど


●settings.iniの書き方

output_dirは保存フォルダのルートです

format：詳しい人以外は変えないでね

filename：pythonの文法で書いてね

n_jobs：アーティストごとの同時実行数、-1でmax

remove_emoji：ファイル名の絵文字を削除（androidに転送するときバグるため）

save_thumbnail：サムネをjpgで保存するか


## 実行

main.pyファイルがある場所をエクスプローラで開きます

エクスプローラのアドレスバーにcmdって書いてenter押すと黒い画面がひらきます

黒い画面でpy -m main

って書いてエンター押すと動いてDLが始まります

DLが終了したらPCを窓から投げ捨てます

おわり



## メモ

エラーハンドリングかなりガバいです自分用なので

linuxの人はsudoでpython呼ぶとパスリセットされます特にpyenv環境でモジュールエラー出たらこれ疑ってください

~~絵文字とかのunicode上の特殊文字含むファイル名はandroidに転送するときエラー出る可能性あります関係ないけど一応~~

→対応しました

動かないときはyoutube-dlのアップグレードしてください

### 2020-02-22

youtube_dlのignoreerrorsオプションが効かないというバグ？のため一部urlがDLできなかった問題の対応